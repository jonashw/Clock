<!DOCTYPE HTML>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Clock</title>
	<script src="Triangle.js"></script>
	<script src="Hand.js"></script>
	<script src="Clock.js"></script>
	<script>
		window.onload = function(){
			var clock1 = new Clock(new Date(null,null,null,2,12,5), 0.3, 0.5, 0.7);
			var el1 = document.getElementById("clock_canvas1");
			displayClock(clock1,el1,200);
			//printDetails(clock1);

			var clock2 = new Clock(new Date(null,null,null,10,25,55), 0.3, 0.5, 0.7);
			var el2 = document.getElementById("clock_canvas2");
			displayClock(clock2,el2,200);
			//printDetails(clock2);

			var clock3 = new Clock(new Date(null,null,null,6,48,12), 0.3, 0.5, 0.7);
			var el3 = document.getElementById("clock_canvas3");
			displayClock(clock3,el3,200);
			//printDetails(clock3);

			function displayClock4(){
				var clock4 = new Clock(new Date(), 0.3, 0.5, 0.7);
				var el4 = document.getElementById("clock_canvas4");
				displayClock(clock4,el4,200);
			}
			displayClock4();
			setInterval(function(){
				displayClock4();
			}, 1000);

			var time = {
				hours: 0,
				minutes: 0,
				seconds: 0,
				next: function(){
					this.seconds++;
					if(this.seconds == 60){
						this.seconds = 0;
						this.minutes++;
						if(this.minutes > 60){
							this.minutes = 0;
							this.hours++;
							if(this.hours > 12) this.hours = 0;
						}
					}
					return new Date(null,null,null, this.hours, this.minutes, this.seconds);
				}
			};
			function displayClock5(){
				var clock5 = new Clock(time.next(), 0.3, 0.5, 0.7);
				var el5 = document.getElementById("clock_canvas5");
				displayClock(clock5,el5,200);
			}
			displayClock5();
			setInterval(function(){
				displayClock5();
			}, 50);
		};

		function displayClock(clock,can,sideLength){
			//configure the canvas
			var ctx = can.getContext("2d");
			can.setAttribute("height",sideLength);
			can.setAttribute("width",sideLength);
			can.style.width = can.style.height = sideLength + "px";

			//
			var center = Math.floor(sideLength / 2);
			var radius = center * 0.85;
			var hh = clock.getHourHand();
			var mh = clock.getMinuteHand();
			var sh = clock.getSecondHand();

			//paint outer circle
			ctx.beginPath();
			ctx.arc(center,center,radius,0,2 * Math.PI);
			ctx.stroke();
			//paint center circle
			ctx.beginPath();
			ctx.arc(center,center,radius/19,0,2 * Math.PI);
			ctx.fill();

			//re-orient the canvas to the center of the clock
			ctx.translate(center,center);
			ctx.rotate(-Math.PI / 2);

			//display the hands
			displayHand(hh,4);
			displayHand(mh,2);
			displayHand(sh,1);
			ctx.rotate(Math.PI / 2);
			ctx.translate(-center,-center);

			//display the time as a string
			ctx.font="10px Georgia";
			ctx.fillText(clock.toString(),0,10);

			function displayHand(hand,lineWidth){//assumed 0,0 is the center of the clock
				ctx.lineWidth = lineWidth;
				ctx.beginPath();
				ctx.moveTo(0,0);
				var t = hand.getTriangle();
				var theta = t.getTheta();
				var H =  t.getH() * radius + center;
				var x = t.getX() * radius;
				var y = t.getY() * radius;
				ctx.lineTo(x, y);
				ctx.stroke();
			}
			function displayNumber(n){
				var nh = new Hand(radius,n,12);
			}
		}

		function printDetails(clock){
			var hh = clock.getHourHand();
			var mh = clock.getMinuteHand();
			var sh = clock.getSecondHand();
			function printRow(name,hand){
				document.write("<tr>");
				document.write("<td>" + name + "</td><td>" + hand.getCurrentValue() + "</td><td>" + hand.getDegrees() + "</td>");
				document.write("</tr>");
			}
			document.write(clock.toString() + "<br>");
			document.write('<table border="1">');
			document.write("<tr>");
			document.write("<th>Component</th><th>Original Value</th><th>Value as Degrees</th>");
			document.write("</tr>");
			printRow('hour',hh);
			printRow('minute',mh);
			printRow('second',sh);
			document.write("</table>");
		};
	</script>
</head>
<body>
	<hr>
	<a href="tests/">Tests</a>
	<hr>
	<canvas id="clock_canvas1"></canvas>
	<canvas id="clock_canvas2"></canvas>
	<canvas id="clock_canvas3"></canvas>
	<canvas id="clock_canvas4"></canvas>
	<canvas id="clock_canvas5"></canvas>
</body>
</html>
